<!DOCTYPE html>
<html>
<head>
    <title>Редактирование заказа</title>
</head>
<body>
    <div>
        <h1>Редактирование заказа #{{ order.id }}</h1>

        {% for message in app.flashes('success') %}
            <div class="alert alert-success">{{ message }}</div>
        {% endfor %}
        
        {% for message in app.flashes('error') %}
            <div class="alert alert-error">{{ message }}</div>
        {% endfor %}

        {{ form_start(form, {'attr': {'enctype': 'multipart/form-data'}}) }}
        
            <div>
                {{ form_label(form.dish) }}
                <div>
                    {% for child in form.dish %}
                        <div>
                            {{ form_widget(child) }}
                            {{ form_label(child) }}
                        </div>
                    {% endfor %}
                </div>
                {{ form_errors(form.dish) }}
            </div>
            
            {% if form.client is defined %}
                <div>
                    {{ form_label(form.client) }}
                    {{ form_widget(form.client) }}
                    {{ form_errors(form.client) }}
                </div>
            {% endif %}
            
            <div>
                {{ form_label(form.uploadedFiles) }}
                {{ form_widget(form.uploadedFiles) }}
                {{ form_errors(form.uploadedFiles) }}
                <small>Можно выбрать несколько файлов</small>
            </div>
            
            {% if order.files|length > 0 %}
                <div>
                    <label>Текущие файлы:</label>
                    <div>
                        {% for file in order.files %}
                            <div>
                                <a href="{{ path('app_order_download_file', {'id': order.id, 'fileId': file.id}) }}">
                                    Файл {{ loop.index }}
                                </a>
                                <form method="post" action="{{ path('app_order_delete_file', {'id': order.id, 'fileId': file.id}) }}" 
                                      style="display: inline; margin-left: 10px;"
                                      onsubmit="return confirm('Удалить этот файл?');">
                                    <input type="hidden" name="_token" value="{{ csrf_token('delete-file-' ~ file.id) }}">
                                    <button type="submit" class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;">Удалить</button>
                                </form>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
            
            <div>
                <button type="submit">Сохранить изменения</button>
                <a href="{{ path('app_profile') }}" >Назад к профилю</a>
            </div>
            
        {{ form_end(form) }}
    </div>
</body>
</html>